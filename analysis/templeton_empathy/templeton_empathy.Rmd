---
title: "Templeton Empathy Analysis"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Set Up 
### Set up workspace and overview population

``` {r}
# install.packages("tidyverse", "corrplot", "ggcorrplot", "lme4", "mediation", "here", "reshape2")
require(tidyverse)
require(sjstats)
require(sjPlot)
require(lmerTest)
require(mediation)
require(here)
require(reshape2)

# Clear workspace
rm(list=ls())

# Read in data
empathy_data <- as_tibble(read.csv(here("templeton_clean_data.csv")))
# Recode gender and remove unnecessary columns
empathy_data <- empathy_data %>% 
  mutate (gender = recode(gender, f = "female", m = "male")) %>%
  dplyr::select (-X, -empathy_sorry_resp_c, -empathy_pain_resp_c)

# Correct data types to factors
empathy_data$unique_id= as.factor(empathy_data$unique_id)
empathy_data$country= as.factor(empathy_data$country)
empathy_data$gender= as.factor(empathy_data$gender)

# Select only children ages 6 - 10
empathy_data <- empathy_data %>% filter(age_years > 5 & age_years < 11)

# Calculate mean empathy score
empathy_data <- empathy_data %>% 
    rowwise() %>% 
    mutate(mean_empathy=mean(c(empathy_pain_resp,empathy_sorry_resp)))

# Mean center the composite
empathy_data <- empathy_data %>% mutate(mean_empathy_c = mean_empathy - mean(empathy_data$mean_empathy, na.rm = TRUE)) # mean_empathy_c is centered




# Helper function to calculate the mean and the standard deviation for each group ####
# Created by http://www.sthda.com/english/wiki/ggplot2-line-plot-quick-start-guide-r-software-and-data-visualization

#+++++++++++++++++++++++++
# data : a data frame
# varname : the name of a column containing the variable
#to be summariezed
# groupnames : vector of column names to be used as
# grouping variables

data_summary <- function(data, varname, groupnames){
  require(plyr)
  summary_func <- function(x, col){
    c(mean = mean(x[[col]], na.rm=TRUE),
      sd = sd(x[[col]], na.rm=TRUE))
  }
  data_sum<-ddply(data, groupnames, .fun=summary_func,
                  varname)
  data_sum <- plyr::rename(data_sum, c("mean" = varname))
  return(data_sum)
}


# Find number of children by country
empathy_data %>%
  group_by(country) %>%
  dplyr::summarise(n = n())

# Find number of children by gender and country
empathy_data %>%
  group_by(gender, country) %>%
  dplyr::summarise(n = n())

# Find mean and SD of age by country
empathy_data %>%
  group_by(country) %>%
  dplyr::summarise(mean_age = mean(age_months, na.rm= TRUE)/12, sd_age = sd(age_months)/12)

# Find mean and SD of QCAE totals by country
empathy_data %>%
  group_by(country) %>%
  dplyr::summarise(parent_qcae_m = mean(parent_qcae_tot, na.rm= TRUE), parent_qcae_sd = sd (parent_qcae_tot, na.rm = TRUE), child_qcae_m = mean(child_qcae_tot, na.rm = TRUE), child_qcae_sd = sd(child_qcae_tot, na.rm = TRUE))


# Find mean and SD of behavioral scores by country
empathy_data %>%
  group_by(country) %>%
  dplyr::summarise(pain_resp_m = mean(empathy_pain_resp, na.rm= TRUE), pain_resp_sd = sd (empathy_pain_resp, na.rm = TRUE), sorry_resp_m = mean(empathy_sorry_resp, na.rm= TRUE), sorry_resp_sd = sd (empathy_sorry_resp, na.rm = TRUE), mean_empathy_m = mean(mean_empathy, na.rm= TRUE), mean_empathy_sd = sd (mean_empathy, na.rm = TRUE))

# Find number of children by age, gender, and country
empathy_data %>%
  group_by(age_years, country, gender) %>%
  dplyr::summarise(n = n())

# Find mean and SD of behavioral scores across countries
empathy_data %>%
  group_by() %>%
  dplyr::summarise(pain_resp_m = mean(empathy_pain_resp, na.rm= TRUE), pain_resp_sd = sd (empathy_pain_resp, na.rm = TRUE), sorry_resp_m = mean(empathy_sorry_resp, na.rm= TRUE), sorry_resp_sd = sd (empathy_sorry_resp, na.rm = TRUE), mean_empathy_m = mean(mean_empathy, na.rm= TRUE), mean_empathy_sd = sd (mean_empathy, na.rm = TRUE))

```

# Descriptive Statistics
## Correlations
``` {r}
# Check if empathy behaviors correlate
cor.test(empathy_data$empathy_pain_resp, empathy_data$empathy_sorry_resp, na.rm=TRUE)

# Check if parent or child QCAE scores correlate with child behavior composite
cor.test(empathy_data$parent_qcae_tot, empathy_data$mean_empathy_c, na.rm=TRUE)
cor.test(empathy_data$child_qcae_tot, empathy_data$mean_empathy_c, na.rm=TRUE)

# Check if empathy behaviors correlate for each country
cor.test(filter(empathy_data, country=="canada" & age_years == 6)$empathy_pain_resp, filter(empathy_data, country=="canada" & age_years == 6)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="canada" & age_years == 7)$empathy_pain_resp, filter(empathy_data, country=="canada" & age_years == 7)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="canada" & age_years == 8)$empathy_pain_resp, filter(empathy_data, country=="canada" & age_years == 8)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="canada" & age_years == 9)$empathy_pain_resp, filter(empathy_data, country=="canada" & age_years == 9)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="canada" & age_years == 10)$empathy_pain_resp, filter(empathy_data, country=="canada" & age_years == 10)$empathy_sorry_resp, use="complete.obs")

cor.test(filter(empathy_data, country=="china" & age_years == 6)$empathy_pain_resp, filter(empathy_data, country=="china" & age_years == 6)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="china" & age_years == 7)$empathy_pain_resp, filter(empathy_data, country=="china" & age_years == 7)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="china" & age_years == 8)$empathy_pain_resp, filter(empathy_data, country=="china" & age_years == 8)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="china" & age_years == 9)$empathy_pain_resp, filter(empathy_data, country=="china" & age_years == 9)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="china" & age_years == 10)$empathy_pain_resp, filter(empathy_data, country=="china" & age_years == 10)$empathy_sorry_resp, use="complete.obs")

cor.test(filter(empathy_data, country=="jordan")$empathy_pain_resp, filter(empathy_data, country=="jordan")$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="jordan" & age_years == 6)$empathy_pain_resp, filter(empathy_data, country=="jordan" & age_years == 6)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="jordan" & age_years == 7)$empathy_pain_resp, filter(empathy_data, country=="jordan" & age_years == 7)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="jordan" & age_years == 8)$empathy_pain_resp, filter(empathy_data, country=="jordan" & age_years == 8)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="jordan" & age_years == 9)$empathy_pain_resp, filter(empathy_data, country=="jordan" & age_years == 9)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="jordan" & age_years == 10)$empathy_pain_resp, filter(empathy_data, country=="jordan" & age_years == 10)$empathy_sorry_resp, use="complete.obs")

cor.test(filter(empathy_data, country=="south_africa")$empathy_pain_resp, filter(empathy_data, country=="south_africa")$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="south_africa" & age_years == 6)$empathy_pain_resp, filter(empathy_data, country=="south_africa" & age_years == 6)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="south_africa" & age_years == 7)$empathy_pain_resp, filter(empathy_data, country=="south_africa" & age_years == 7)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="south_africa" & age_years == 8)$empathy_pain_resp, filter(empathy_data, country=="south_africa" & age_years == 8)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="south_africa" & age_years == 9)$empathy_pain_resp, filter(empathy_data, country=="south_africa" & age_years == 9)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="south_africa" & age_years == 10)$empathy_pain_resp, filter(empathy_data, country=="south_africa" & age_years == 10)$empathy_sorry_resp, use="complete.obs")

cor.test(filter(empathy_data, country=="turkey")$empathy_pain_resp, filter(empathy_data, country=="turkey")$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="turkey" & age_years == 6)$empathy_pain_resp, filter(empathy_data, country=="turkey" & age_years == 6)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="turkey" & age_years == 7)$empathy_pain_resp, filter(empathy_data, country=="turkey" & age_years == 7)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="turkey" & age_years == 8)$empathy_pain_resp, filter(empathy_data, country=="turkey" & age_years == 8)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="turkey" & age_years == 9)$empathy_pain_resp, filter(empathy_data, country=="turkey" & age_years == 9)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="turkey" & age_years == 10)$empathy_pain_resp, filter(empathy_data, country=="turkey" & age_years == 10)$empathy_sorry_resp, use="complete.obs")

cor.test(filter(empathy_data, country=="usa")$empathy_pain_resp, filter(empathy_data, country=="usa")$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="usa" & age_years == 6)$empathy_pain_resp, filter(empathy_data, country=="usa" & age_years == 6)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="usa" & age_years == 7)$empathy_pain_resp, filter(empathy_data, country=="usa" & age_years == 7)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="usa" & age_years == 8)$empathy_pain_resp, filter(empathy_data, country=="usa" & age_years == 8)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="usa" & age_years == 9)$empathy_pain_resp, filter(empathy_data, country=="usa" & age_years == 9)$empathy_sorry_resp, use="complete.obs")
cor.test(filter(empathy_data, country=="usa" & age_years == 10)$empathy_pain_resp, filter(empathy_data, country=="usa" & age_years == 10)$empathy_sorry_resp, use="complete.obs")

# Check if parent empathy subscales are correlated for each country
cor.test(filter(empathy_data, country=="canada")$parent_qcae_cog, filter(empathy_data, country=="canada")$parent_qcae_aff, use="complete.obs")
cor.test(filter(empathy_data, country=="china")$parent_qcae_cog, filter(empathy_data, country=="china")$parent_qcae_aff, use="complete.obs")
cor.test(filter(empathy_data, country=="jordan")$parent_qcae_cog, filter(empathy_data, country=="jordan")$parent_qcae_aff, use="complete.obs")
cor.test(filter(empathy_data, country=="south_africa")$parent_qcae_cog, filter(empathy_data, country=="south_africa")$parent_qcae_aff, use="complete.obs")
cor.test(filter(empathy_data, country=="turkey")$parent_qcae_cog, filter(empathy_data, country=="turkey")$parent_qcae_aff, use="complete.obs")
cor.test(filter(empathy_data, country=="usa")$parent_qcae_cog, filter(empathy_data, country=="usa")$parent_qcae_aff, use="complete.obs")

# Check if parent empathy subscales are correlated overall
cor.test(empathy_data$parent_qcae_cog, empathy_data$parent_qcae_aff, use="complete.obs")

# Check if parent and child QCAE are correlated for each country
cor.test(filter(empathy_data, country=="canada")$parent_qcae_tot, filter(empathy_data, country=="canada")$child_qcae_tot, use="complete.obs")
cor.test(filter(empathy_data, country=="china")$parent_qcae_tot, filter(empathy_data, country=="china")$child_qcae_tot, use="complete.obs")
cor.test(filter(empathy_data, country=="jordan")$parent_qcae_tot, filter(empathy_data, country=="jordan")$child_qcae_tot, use="complete.obs")
cor.test(filter(empathy_data, country=="south_africa")$parent_qcae_tot, filter(empathy_data, country=="south_africa")$child_qcae_tot, use="complete.obs")
cor.test(filter(empathy_data, country=="turkey")$parent_qcae_tot, filter(empathy_data, country=="turkey")$child_qcae_tot, use="complete.obs")
cor.test(filter(empathy_data, country=="usa")$parent_qcae_tot, filter(empathy_data, country=="usa")$child_qcae_tot, use="complete.obs")

# Check if parent empathy subscales are correlated overall
cor.test(empathy_data$parent_qcae_tot, empathy_data$child_qcae_tot, use="complete.obs")

#Visualize correlations between behaviors
empathy_data %>%
  ggplot(aes(x=empathy_pain_resp, y=empathy_sorry_resp, group=country, color=country)) + 
  geom_smooth() +
  geom_point()+
  scale_color_brewer(palette="Paired")+theme_minimal() +
  xlab("Pain Sensitivity Score") + ylab("Empathic Concern Score") +
  labs(colour = "Country") +
  facet_wrap(~country) +
  theme(plot.title = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.text.x = element_text(color = "grey20", size = 16, angle = 90, hjust = .5, vjust = .5, face = "plain"),
        axis.text.y = element_text(color = "grey20", size = 16, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.title.x = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = 0, face = "plain"),
        axis.title.y = element_text(color = "grey20", size = 20, angle = 90, hjust = .5, vjust = .5, face = "plain"))

# Are parent cognitive and affective empathy correlated?
cor.test(empathy_data$parent_qcae_aff, empathy_data$parent_qcae_cog, use="complete.obs")

#Visualize correlations between parent cognitive and affective empathy
empathy_data %>%
  ggplot(aes(x=parent_qcae_cog, y=parent_qcae_aff, group=country, color=country)) + 
  geom_smooth() +
  geom_point()+
  scale_color_brewer(palette="Paired")+theme_minimal() +
  xlab("Parent Cognitive Empathy") + ylab("Parent Affective Empathy") +
  labs(colour = "Country") +
  facet_wrap(~country) +
  theme(plot.title = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.text.x = element_text(color = "grey20", size = 16, angle = 90, hjust = .5, vjust = .5, face = "plain"),
        axis.text.y = element_text(color = "grey20", size = 16, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.title.x = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = 0, face = "plain"),
        axis.title.y = element_text(color = "grey20", size = 20, angle = 90, hjust = .5, vjust = .5, face = "plain"))

#Visualize correlations between parent reported empathy subscales
empathy_data %>%
  ggplot(aes(x=parent_qcae_cog, y=parent_qcae_aff)) + 
  geom_smooth(method=lm) +
  geom_point()+
  scale_color_brewer(palette="Paired")+theme_minimal() +
  xlab("Parent Cognitive Empathy") + ylab("Parent Affective Empathy") +
  theme(plot.title = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.text.x = element_text(color = "grey20", size = 16, angle = 90, hjust = .5, vjust = .5, face = "plain"),
        axis.text.y = element_text(color = "grey20", size = 16, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.title.x = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = 0, face = "plain"),
        axis.title.y = element_text(color = "grey20", size = 20, angle = 90, hjust = .5, vjust = .5, face = "plain"))

#Visualize correlations between parent and child reported empathy 
empathy_data %>%
  ggplot(aes(x=parent_qcae_tot, y=child_qcae_tot)) + 
  geom_smooth(method=lm) +
  geom_point()+
  scale_color_brewer(palette="Paired")+theme_minimal() +
  xlab("Parent Total QCAE") + ylab("Child Total QCAE") +
  labs(colour = "Country") +
  theme(plot.title = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.text.x = element_text(color = "grey20", size = 16, angle = 90, hjust = .5, vjust = .5, face = "plain"),
        axis.text.y = element_text(color = "grey20", size = 16, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.title.x = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = 0, face = "plain"),
        axis.title.y = element_text(color = "grey20", size = 20, angle = 90, hjust = .5, vjust = .5, face = "plain"))

#Visualize correlations between parent and child reported empathy by country
empathy_data %>%
  ggplot(aes(x=child_qcae_tot, y=parent_qcae_tot, group=country, color=country)) + 
  geom_smooth() +
  geom_point()+
  scale_color_brewer(palette="Paired")+theme_minimal() +
  xlab("Child QCAE Total") + ylab("Parent QCAE Total") +
  labs(colour = "Country") +
  facet_wrap(~country) +
  theme(plot.title = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.text.x = element_text(color = "grey20", size = 16, angle = 90, hjust = .5, vjust = .5, face = "plain"),
        axis.text.y = element_text(color = "grey20", size = 16, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.title.x = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = 0, face = "plain"),
        axis.title.y = element_text(color = "grey20", size = 20, angle = 90, hjust = .5, vjust = .5, face = "plain"))

```

```{r}
head(empathy_data)
```

# Empathy Behavior and Cultural Collectivism
#### Hypothesis: If a child is raised in a more collectivist country, then they will show greater cognitive and affective empathy, replicating the findings of Chopik, O'Brian & Konrath 2016
Dependent Variables: Child behaviors (sorry, pain, and composite)
Independent Variables: High-low median split based on Hofstede individualism score
Analyses: For each behavior, t-test between collectivist and individualist countries
Interpretation: If behavior scores are higher in high-collectivism countries, then our data replicate the Chopik findings that those in more collectivist countries show greater empathy


```{r}
t.test(filter(empathy_data, individualism_split=="individualist")$empathy_pain_resp, filter(empathy_data, individualism_split=="collectivist")$empathy_pain_resp)

t.test(filter(empathy_data, individualism_split=="individualist")$empathy_pain_resp_c, filter(empathy_data, individualism_split=="collectivist")$empathy_pain_resp_c)

t.test(filter(empathy_data, individualism_split=="individualist")$empathy_sorry_resp, filter(empathy_data, individualism_split=="collectivist")$empathy_sorry_resp)

t.test(filter(empathy_data, individualism_split=="individualist")$empathy_sorry_resp_c, filter(empathy_data, individualism_split=="collectivist")$empathy_sorry_resp_c)

t.test(filter(empathy_data, individualism_split=="individualist")$mean_empathy, filter(empathy_data, individualism_split=="collectivist")$mean_empathy)


# Visualize parent QCAE by split
parent_summary <- reshape2::melt(empathy_data %>%
  group_by(individualism_split) %>%
  dplyr::summarise(parent_aff = mean(parent_qcae_aff, na.rm=TRUE), parent_cog = mean(parent_qcae_cog, na.rm=TRUE), parent_tot = mean(parent_qcae_tot, na.rm=TRUE )), id.vars="individualism_split")

ggplot(parent_summary, aes(fill=individualism_split, y=value, x=variable)) + 
    geom_bar(position="dodge", stat="identity") +
  scale_x_discrete(labels=c("parent_cog" = "QCAE Cognitive Empathy", "parent_aff" = "QCAE Affective Empathy", "parent_tot" = "QCAE Total Empathy")) + 
  ylim(NA, 100) +
  ylab("Parent Score") +
  theme(axis.title.x = element_blank()) +
  labs(fill = "Cultural Split")
  
# Visualize child QCAE by split
child_summary <- melt(empathy_data %>%
  group_by(individualism_split) %>%
  dplyr::summarise(child_aff = mean(child_qcae_aff, na.rm=TRUE), child_cog = mean(child_qcae_cog, na.rm=TRUE), child_tot = mean(child_qcae_tot, na.rm=TRUE)), id.vars="individualism_split")

ggplot(child_summary, aes(fill=individualism_split, y=as.numeric(value), x=variable)) + 
    geom_bar(position="dodge", stat="identity") +
  ylim(NA, 100) +
  scale_x_discrete(labels=c("child_cog" = "QCAE Cognitive Empathy", "child_aff" = "QCAE Affective Empathy",
                              "child_tot" = "QCAE Total Empathy")) + 
  ylab("Child Score") +
  theme(axis.title.x = element_blank()) +
  labs(fill = "Cultural Split")
  
# Visualize child behavior by split
behavior_summary <- melt(empathy_data %>%
  group_by(individualism_split) %>%
  dplyr::summarise(cog_emp = mean(empathy_pain_resp, na.rm=TRUE), emp_con = mean(empathy_sorry_resp, na.rm=TRUE)), id.vars="individualism_split")

ggplot(behavior_summary, aes(fill=individualism_split, y=as.numeric(value), x=variable)) + 
    geom_bar(position="dodge", stat="identity") +
  ylim(NA, 100) +
  scale_x_discrete(labels=c("cog_emp" = "Pain Sensitivity", "emp_con" = "Empathic Concern")) + 
  ylab("Child Score") +
  theme(axis.title.x = element_blank()) +
  labs(fill = "Cultural Split")


```


# Self-Reported Empathy and Cultural Collectivism
#### Hypothesis: If a child is raised in a more collectivist country, then they will show greater cognitive and affective empathy, replicating the findings of Chopik, O'Brian & Konrath 2016
Dependent Variables: QCAE scores (affective, cognitive, and total for child and parent)
Independent Variables: High-low median split based on Hofstede individualism score
Analyses: For each child QCAE score, t-test between collectivist and individualist countries
Interpretation: If QCAE scores are higher in high-collectivism countries, then our data replicate the Chopik findings that those in more collectivist countries show greater empathy


```{r}
t.test(filter(empathy_data, individualism_split=="individualist")$parent_qcae_cog, filter(empathy_data, individualism_split=="collectivist")$parent_qcae_cog)

t.test(filter(empathy_data, individualism_split=="individualist")$parent_qcae_aff, filter(empathy_data, individualism_split=="collectivist")$parent_qcae_aff)

t.test(filter(empathy_data, individualism_split=="individualist")$parent_qcae_tot, filter(empathy_data, individualism_split=="collectivist")$parent_qcae_tot)

t.test(filter(empathy_data, individualism_split=="individualist")$child_qcae_cog, filter(empathy_data, individualism_split=="collectivist")$child_qcae_cog)

t.test(filter(empathy_data, individualism_split=="individualist")$child_qcae_aff, filter(empathy_data, individualism_split=="collectivist")$child_qcae_aff)

t.test(filter(empathy_data, individualism_split=="individualist")$child_qcae_tot, filter(empathy_data, individualism_split=="collectivist")$child_qcae_tot)
```

# Development of Empathy
####	Hypothesis: Cognitive empathy and empathic concern will vary by child age
Dependent Variables: Age in months, age in years
Independent Variables: Child behavior (composite)
Analyses: Linear regressions predicting each behavior by each age type
Interpretation: If there is a significant main effect of age on each behavior, then empathic behavior varies by age


``` {r, echo = TRUE}
mean_years <- lm(mean_empathy_c ~ age_years, data = empathy_data)
summary(mean_years)

mean_months <- lm(mean_empathy_c ~ age_months, data = empathy_data)
summary(mean_months)

ggplot(data=empathy_data, aes(x=age_months, y=mean_empathy)) +
  geom_point()+
  geom_smooth(method = lm) + 
  labs(x = "Age (months)", y = "Mean Empathy Score (Behavioral)")
  
 ggplot(empathy_data, aes(x=as.factor(age_years), y=mean_empathy)) + 
   geom_boxplot( )

```


#### Empathyâs Developmental Trajectory by Country
#	Hypothesis: Empathy score trajectories will vary by country/ gender
Dependent Variables: Empathy score (behavioral composite)
Independent Variables: age_months, age_years, country, gender
Analyses: For each type of age variable, run the following:
1.	lm(behavior ~ age * individualism)
2.	lm(behavior ~ age * individualism + gender)
3.	Compare these two using AIC scores
Interpretation: If the interaction of age and country is significant, then trajectories vary by country. If model 2 has a lower AIC score, then the behavior also varies by gender.


``` {r, echo = TRUE}
mean_months_country <- lm(mean_empathy_c ~ age_months * individualism, data = empathy_data)
summary(mean_months_country)
mean_months_country_gender <- lm(mean_empathy_c ~ age_months * individualism + gender, data = empathy_data)
summary(mean_months_country_gender)
AIC(mean_months)
AIC(mean_months_country) # adding country improves fit
AIC(mean_months_country_gender) # adding gender improves fit

# Double-check with age in years
mean_years_country <- lm(mean_empathy_c ~ age_years * individualism, data = empathy_data)
summary(mean_years_country)
mean_years_country_gender <- lm(mean_empathy_c ~ age_years * individualism + gender, data = empathy_data)
summary(mean_years_country_gender)

# Summarize and visualize best-fitting models (note: show raw empathy score, not mean centered)
raw_mean_months_country_gender <- lm(mean_empathy ~ age_months * individualism + gender, data = empathy_data)
summary(raw_mean_months_country_gender)
plot_model(raw_mean_months_country_gender, type='int') 

# Visualization of each behavior by age, country, and gender
mean_years_summary <- data_summary(empathy_data, varname="empathy_mean", groupnames=c("country", "age_months", "gender"))

mean_years_summary %>%
  filter(!is.na(gender)) %>%
  ggplot(aes(x=age_months, y=empathy_mean, group=country, color=country)) + 
  geom_point()+
  geom_smooth(method = lm) +
  scale_color_brewer(palette="Paired")+theme_minimal() +
  xlab("Age (months)") + ylab("Behavioral Empathy Composite Score") +
  labs(colour = "Country") +
  facet_wrap(~gender) +
  theme(plot.title = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.text.x = element_text(color = "grey20", size = 16, angle = 90, hjust = .5, vjust = .5, face = "plain"),
        axis.text.y = element_text(color = "grey20", size = 16, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.title.x = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = 0, face = "plain"),
        axis.title.y = element_text(color = "grey20", size = 20, angle = 90, hjust = .5, vjust = .5, face = "plain"))


```

#### Parent and Child Empathy
# Hypothesis: Parent-reported cognitive and affective empathy will better predict empathic concern and cognitive empathy behaviors than age and country alone
Dependent Variables: Child behavior (empathy composite)
Independent Variables: Total QCAE score for parent, age in months, age in years, country
Analyses: For each type of age variable, run the following:
1. lm(behavior ~ age * country + parent_qcae_tot)
2.	Compare this to lm(behavior ~ age) using AIC scores
Interpretation: If model 2 has a lower AIC score, then empathy score varies by parent QCAE.


``` {r, echo = TRUE}

mean_months_country_qcae <- lm(mean_empathy_c ~ age_months * individualism + parent_qcae_tot, data = empathy_data)
summary(mean_months_country_qcae)
AIC(mean_months_country)
AIC(mean_months_country_qcae) # adding qcae improves fit

# Check with age in years
mean_years_country_qcae <- lm(mean_empathy ~ age_years * individualism + parent_qcae_tot, data = empathy_data)
summary(mean_years_country_qcae)

mean_months_country_gender_qcae <- lm(mean_empathy_c ~ age_months * individualism + gender + parent_qcae_tot, data = empathy_data)
summary(mean_months_country_gender_qcae)
AIC(mean_months_country_gender)
AIC(mean_months_country_gender_qcae) # adding qcae improves fit

# Summarize and visualize best-fitting models
plot_model(mean_months_country_qcae, type = 'int')
tab_model(mean_months_country_qcae, show.std = 'std')

```

#### Parent-Child Empathy Transmission
# Hypothesis: Self-reported parent empathy will mediate the country effect on empathy score
Dependent Variables: Behaviors (cognitive empathy and empathic concern scores)
Independent Variables: Hofstede collectivism score, parent total QCAE score
Analyses: For each country-behavior combination, run the following
1. lm(behavior ~ individualism)
* If b1 is significant, then there is a relationship between the parentâs self-reported empathy and the childâs behavior, which the countryâs cultural environment may mediate
2. lm(parent_qcae_tot ~ individualism)
* If b2 is not significant, then the countryâs QCAE is just a third variable which may or may not be associated with the behavior
3. lm(behavior ~ individualism + parent_qcae_tot)
* If b3 (QCAE) is significant and b4 (individualism) is not significant or smaller than before, then there is a mediation effect of culture on the relationship between parent empathy and child behavior.
4. mediate(lm(parent_qcae_tot ~ individualism, empathy_data), lm(behavior ~ individualism + parent_qcae_tot, empathy_data), treat=individualism, mediator= parent_qcae_tpt, boot=TRUE, sims=100)
* If the ACME score is significant, then the mediation effect is significant
5. lavaan(lm(behavior ~ individualism, empathy_data), lm(behavior ~ individualism + parent_qcae_tot, empathy_data), treat=individualism, mediator= parent_qcae_tpt, boot=TRUE, sims=100)
* Look for significant a, b, and ab effects

Interpretation: If there is a significant mediation effect of cultural individualism on the relationship between parent empathy and child behavior, then there are cross-cultural differences in transmission of empathy from parent to child

``` {r, echo = TRUE}

## Mediation using "lavaan" package

empathy_mediation = 'parent_qcae_tot  ~ a1*individualism
mean_empathy_c ~ b1*parent_qcae_tot + c*individualism
indirect1 := a1*b1
direct := c
total := c + (a1*b1) 
'

mediation_data <- empathy_data %>% 
  dplyr::select(individualism, mean_empathy_c, parent_qcae_tot) %>%
  filter(!is.na(mean_empathy_c))

empathy_fit <- lavaan::sem(empathy_mediation, se = "boot", bootstrap = 1000, data = mediation_data, 
                  likelihood = "wishart")

lavaan::parameterEstimates(pain_fit,  standardized=TRUE) %>% 
  knitr::kable()

```


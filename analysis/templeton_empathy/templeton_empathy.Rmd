---
title: "Templeton Empathy Analysis"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Set Up 
### Set up workspace and overview population

``` {r}
# install.packages("tidyverse", "corrplot", "ggcorrplot", "lme4", "mediation", "here", "reshape2", "lsr")
require(tidyverse)
require(sjstats)
require(sjPlot)
require(lmerTest)
require(mediation)
require(here)
require(reshape2)
require(lsr)

# Clear workspace
rm(list=ls())

# Read in data
empathy_data <- as_tibble(read.csv(here("templeton_clean_data.csv")))

# Recode gender and remove unnecessary columns
empathy_data <- empathy_data %>% 
  mutate (gender = recode(gender, f = "female", m = "male")) %>%
  dplyr::select (-X, -empathy_sorry_resp_c, -empathy_pain_resp_c)

# Correct data types to factors
empathy_data$unique_id= as.factor(empathy_data$unique_id)
empathy_data$country= as.factor(empathy_data$country)
empathy_data$gender= as.factor(empathy_data$gender)

# Select only children ages 6 - 10
empathy_data <- empathy_data %>% filter(age_months >= 72 & age_months < 132)

# Calculate mean empathy score
empathy_data <- empathy_data %>% 
    rowwise() %>% 
    mutate(mean_empathy=mean(c(empathy_pain_resp,empathy_sorry_resp)))

# Mean center the composite
empathy_data <- empathy_data %>% mutate(mean_empathy_c = mean_empathy - mean(empathy_data$mean_empathy, na.rm = TRUE)) # mean_empathy_c is centered

# Mean center altruism
empathy_data <- empathy_data %>% mutate(dictator_shared_c = dictator_shared - mean(empathy_data$dictator_shared, na.rm = TRUE)) # dictator_shared_c is centered

# Helper function to calculate the mean and the standard deviation for each group ####
# Created by http://www.sthda.com/english/wiki/ggplot2-line-plot-quick-start-guide-r-software-and-data-visualization

#+++++++++++++++++++++++++
# data : a data frame
# varname : the name of a column containing the variable
#to be summariezed
# groupnames : vector of column names to be used as
# grouping variables

data_summary <- function(data, varname, groupnames){
  require(plyr)
  summary_func <- function(x, col){
    c(mean = mean(x[[col]], na.rm=TRUE),
      sd = sd(x[[col]], na.rm=TRUE))
  }
  data_sum<-ddply(data, groupnames, .fun=summary_func,
                  varname)
  data_sum <- plyr::rename(data_sum, c("mean" = varname))
  return(data_sum)
}


# Find number of children by gender, age, and country
empathy_data %>%
  group_by(age_years, country, gender) %>%
  dplyr::summarise(n = n())

# Find mean and SD of age by country
empathy_data %>%
  group_by(country) %>%
  dplyr::summarise(mean_age = mean(age_months, na.rm= TRUE)/12, sd_age = sd(age_months)/12)

```

# Correlations
``` {r}
# Check if any predictors for regression models are correlated

# Check if parent QCAE scores and SES are correlated
cor.test(empathy_data$maternal_edu, empathy_data$parent_qcae_tot, na.rm=TRUE)
# Check if parent QCAE scores and child age are correlated
cor.test(empathy_data$age_months, empathy_data$parent_qcae_tot, na.rm=TRUE)
# Check if parent QCAE scores and Hofstede score are correlated
cor.test(empathy_data$individualism, empathy_data$parent_qcae_tot, na.rm=TRUE)
# Check if maternal education and Hofstede score are correlated
cor.test(empathy_data$maternal_edu, empathy_data$individualism, na.rm=TRUE)
# Check if age and Hofstede score are correlated
cor.test(empathy_data$age_months, empathy_data$individualism, na.rm=TRUE)
# Check if age and maternal education are correlated
cor.test(empathy_data$age_months, empathy_data$maternal_edu, na.rm=TRUE)

# Check if empathy behaviors correlate
cor.test(empathy_data$empathy_pain_resp, empathy_data$empathy_sorry_resp, na.rm=TRUE)

#Visualize correlations between empathy behaviors by country
empathy_data %>%
  mutate(country = recode (country, "canada"= "Canada", "china" = "China", "jordan" = "Jordan", "colombia" = "Colombia", "turkey" = "Turkey", "usa" = "USA", "south_africa" = "South Africa")) %>%
  ggplot(aes(x=empathy_pain_resp, y=empathy_sorry_resp, group=country, color=country)) + 
  geom_smooth( method = "lm") +
  stat_cor(method = "pearson",label.y = 100) +
  geom_point()+
  theme_minimal() +
  xlab("Pain Sensitivity Score") + ylab("Empathic Concern Score") +
  labs(colour = "Country") +
  facet_wrap(~country) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "grey50"),
plot.title = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.text.x = element_text(color = "grey20", size = 16, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.text.y = element_text(color = "grey20", size = 16, angle = 0, hjust = .5, vjust = .5, face = "plain"),
        axis.title.x = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = 0, face = "plain"),
        axis.title.y = element_text(color = "grey20", size = 20, angle = 90, hjust = .5, vjust = .5, face = "plain"),
        legend.position = "none")

# Save visualization
ggsave("empathy_behaviors_correlation.png")


```

# Development of Empathy
####	Hypothesis: Empathy will increase with age and cultural individualism. Girls will show greater empathy. Children whose parents have higher QCAE scores will show greater empathy.
Dependent Variables: Child behavior (composite)
Independent Variables: Age in months (double-check the same effect in a separate model with age in years), Hofstede I/C score (in an interaction with age), child gender, parent total QCAE, maternal education
Analyses: Series of linear regressions predicting each behavior with predictors added in consecutive blocks
Interpretation: If there is a significant main effect of a given predictor on each behavior, then empathic behavior varies by that predictor


``` {r, echo = TRUE}
# Empathy by age in months
empathy_months <- lm(mean_empathy_c ~ age_months, data = empathy_data)
summary(empathy_months)
# Empathy by age in months and I/C score
empathy_months_individualism <- lm(mean_empathy_c ~ age_months*individualism, data = empathy_data)
summary(empathy_months_individualism)
# Empathy by age in months, I/C score, and gender
empathy_months_individualism_gender <- lm(mean_empathy_c ~ age_months*individualism + gender, data = empathy_data)
summary(empathy_months_individualism_gender)
# Empathy by age in months, I/C score, gender, parent QCAE, and maternal education
empathy_months_individualism_gender_pqcae_edu <- lm(mean_empathy_c ~ age_months*individualism + gender + parent_qcae_tot + maternal_edu, data = empathy_data)
summary(empathy_months_individualism_gender_pqcae_edu)

# Check the same models using age in years
# Empathy by age in years
empathy_years <- lm(mean_empathy_c ~ age_years, data = empathy_data)
summary(empathy_years)
# Empathy by age in years and I/C score
empathy_years_individualism <- lm(mean_empathy_c ~ age_years*individualism, data = empathy_data)
summary(empathy_years_individualism)
# Empathy by age in years, I/C score, and gender
empathy_years_individualism_gender <- lm(mean_empathy_c ~ age_years*individualism + gender, data = empathy_data)
summary(empathy_years_individualism_gender)
# Empathy by age in years, I/C score, gender, parent QCAE, and maternal education
empathy_years_individualism_gender_pqcae_edu <- lm(mean_empathy_c ~ age_years*individualism + gender + parent_qcae_tot + maternal_edu, data = empathy_data)
summary(empathy_years_individualism_gender_pqcae_edu)

```
# Development of Empathic Disposition
####	Hypothesis: Empathic Disposition will increase with age and cultural individualism. Girls will show greater empathic disposition. Children whose parents have higher QCAE scores will show greater empathic disposition.
Dependent Variables: Child QCAE (total score)
Independent Variables: Age in months (double-check the same effect in a separate model with age in years), Hofstede I/C score (in an interaction with age), child gender, parent total QCAE, maternal education
Analyses: Series of linear regressions predicting each behavior with predictors added in consecutive blocks
Interpretation: If there is a significant main effect of a given predictor on each behavior, then empathic disposition varies by that predictor


``` {r, echo = TRUE}
# Empathic disposition by age in months
cqcae_months <- lm(child_qcae_tot ~ age_months, data = empathy_data)
summary(cqcae_months)
# Empathic disposition by age in months and I/C score
cqcae_months_individualism <- lm(child_qcae_tot ~ age_months*individualism, data = empathy_data)
summary(cqcae_months_individualism)
# Empathic disposition by age in months, I/C score, and gender
cqcae_months_individualism_gender <- lm(child_qcae_tot ~ age_months*individualism + gender, data = empathy_data)
summary(cqcae_months_individualism_gender)
# Empathic disposition by age in months, I/C score, gender, parent QCAE, and maternal education
cqcae_months_individualism_gender_pqcae_edu <- lm(child_qcae_tot ~ age_months*individualism + gender + parent_qcae_tot + maternal_edu, data = empathy_data)
summary(cqcae_months_individualism_gender_pqcae_edu)

# Check the same models using age in years
# Empathic disposition by age in years
cqcae_years <- lm(child_qcae_tot ~ age_years, data = empathy_data)
summary(cqcae_years)
# Empathic disposition by age in years and I/C score
cqcae_years_individualism <- lm(child_qcae_tot ~ age_years*individualism, data = empathy_data)
summary(cqcae_years_individualism)
# Empathic disposition by age in years, I/C score, and gender
cqcae_years_individualism_gender <- lm(child_qcae_tot ~ age_years*individualism + gender, data = empathy_data)
summary(cqcae_years_individualism_gender)
# Empathic disposition by age in years, I/C score, gender, parent QCAE, and maternal education
cqcae_years_individualism_gender_pqcae_edu <- lm(child_qcae_tot ~ age_years*individualism + gender + parent_qcae_tot + maternal_edu, data = empathy_data)
summary(cqcae_years_individualism_gender_pqcae_edu)

```


#### Exploratory analyses of altruism and parent QCAE

# Parent QCAE score by culture
Dependent Variables: Parent QCAE score
Independent Variables: Hofstede score
Interpretation: If there is a significant negative main effect of Hofstede score, then parents in more collectivist countries have greater empathic disposition

``` {r, echo = TRUE}
pqcae_culture <- lm(parent_qcae_tot ~ individualism, data = empathy_data)
```

# Altruism by gender, age, SES
Dependent Variables: Altruism (stickers shared)
Independent Variables: Age in years (confirm that holds true by age in months), gender, maternal education
Analyses: ANCOVA
Interpretation: If there is a significant main effect of an IV on altruism, then altruism varies by that IV

``` {r, echo = TRUE}
# ANCOVA with age in years
dictator_months_gender_edu <- aov(dictator_shared_c ~ gender * age_months * maternal_edu, data = empathy_data)
summary(dictator_months_gender_edu)
etaSquared(dictator_months_gender_edu)

# Check against ANCOVA with age in years
dictator_years_gender_edu <- aov(dictator_shared_c ~ gender * age_years * maternal_edu, data = empathy_data)
summary(dictator_years_gender_edu)
etaSquared(dictator_years_gender_edu)

```
# Parent QCAE score by culture
Dependent Variables: Parent QCAE score
Independent Variables: Hofstede score
Analyses: Regression predicting parent QCAE score
Interpretation: If there is a significant negative main effect of Hofstede score, then parents in more collectivist countries have greater empathic disposition

``` {r, echo = TRUE}
pqcae_culture <- lm(parent_qcae_tot ~ individualism, data = empathy_data)
summary(pqcae_culture)
```


# Altruism by maternal education
Dependent Variables: Stickers shared
Independent Variables: Maternal education
Analyses: Regression predicting altruism
Interpretation: If there is a positive main effect of maternal education, then children with more educated mothers share more

``` {r, echo = TRUE}
dictator_edu <- lm(dictator_shared ~ maternal_edu, data = empathy_data)
summary(dictator_edu)
```

# Altruism by parent QCAE
Dependent Variables: Stickers shared
Independent Variables: Parent QCAE (total)
Analyses: Regression predicting altruism
Interpretation: If there is a positive main effect of parent QCAE, then children with mothers with higher empathic dispositions share more

``` {r, echo = TRUE}
dictator_pqcae <- lm(dictator_shared ~ parent_qcae_tot, data = empathy_data)
summary(dictator_pqcae)
```



#### Parent-Child Empathy Transmission: Mediation
# Hypothesis: Self-reported parent empathic disposition will mediate the country effect on empathy score
Dependent Variables: Empathy score (composite)
Independent Variables: Hofstede collectivism score, parent total QCAE score
Analyses: Mediation of parent empathic disposition on child empathy behavior by Hofstede score
Interpretation: If there is a significant mediation effect of cultural individualism on the relationship between parent empathic disposition and child behavior, then there are cross-cultural differences in transmission of empathy from parent to child

``` {r, echo = TRUE}

## Mediation using "lavaan" package

empathy_mediation = 'parent_qcae_tot  ~ a1*individualism
mean_empathy_c ~ b1*parent_qcae_tot + c*individualism
indirect1 := a1*b1
direct := c
total := c + (a1*b1) 
'

mediation_data <- empathy_data %>% 
  dplyr::select(individualism, mean_empathy_c, parent_qcae_tot) %>%
  filter(!is.na(mean_empathy_c))

empathy_fit <- lavaan::sem(empathy_mediation, se = "boot", bootstrap = 1000, data = mediation_data, 
                  likelihood = "wishart")

lavaan::parameterEstimates(empathy_fit,  standardized=TRUE) %>% 
  knitr::kable()

```

